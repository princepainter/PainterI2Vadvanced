# PainterI2VAdvanced 本节点由抖音博主：绘画小子制作

本节点是对PainterI2V的优化版本，它是一个增强的 Wan2.2 图生视频节点，专为双采样器工作流优化，提供动态增强和智能颜色漂移校正功能。修复了PainterI2V画面不受控制的变换场景和偏灰偏绿问题，增强动态不变色。

![wan2-2_00004](https://github.com/user-attachments/assets/69caf9df-bf40-4c7c-8875-2c4d6a4a4812)



## 功能特性

- **双输出设计**: 同时输出高动态(high)和低动态(low)两组条件，完美适配双采样器架构
- **智能颜色保护**: 防止高动态幅度下常见的偏绿、偏暗问题
- **零动态损失**: 后处理校正策略，完全保留原始动态增强效果
- **可调参数**: 精细控制动态幅度和颜色校正强度
- **直观命名**: 输出端口清晰标注，便于工作流连接
<img width="952" height="366" alt="image" src="https://github.com/user-attachments/assets/dc04d4c4-6f05-48a3-a34e-e1710ad5f812" />

## 安装方法

1. git 安装

2. 重启 ComfyUI

3. 在节点面板中找到 `conditioning/video_models` 分类下的 `PainterI2VAdvanced`

## 节点接口

## 参数详解

### motion_amplitude（动态增强幅度）

**作用**: 控制视频动态强度。值越大，动作幅度越明显。

**推荐设置**:
- 轻微动作（如说话、眨眼）: 1.0-1.5
- 中等动作（如走路、手势）: 1.5-2.0
- 大幅度动作（如跑步、跳跃）: 2.0-3.0
- 极端动态（如快速奔跑、剧烈运动）: 3.0-5.0

**注意事项**: `correct_strength`一般情况下，设置0.01~0.1之间即可！值超过3.0时，建议适当增加`correct_strength`至0.1-0.15

### color_protect（颜色保护开关）

**作用**: 启用/禁用颜色漂移校正功能

**推荐设置**: 保持开启（True）

**效果**: 防止视频在动态增强后偏绿、偏暗或颜色失真

### correct_strength（颜色校正强度）

**作用**: 控制颜色漂移校正的强度。值越大，颜色校正越明显。

**推荐设置**:
- 无颜色问题: 0.0（关闭）
- 轻微漂移: 0.01~0.05（默认）
- 明显偏色: 0.1-0.15
- 严重漂移: 0.2-0.3

**调优技巧**:
1. 从0.05开始测试
2. 如果还有轻微偏色，逐步增加到0.1
3. 如果动态感觉被削弱，立即降回0.05
4. 该参数只影响颜色，不影响动态幅度

### 参数配置建议

**高噪采样器（负责动态）**:
- 模型: wan2.2_i2v_high_noise_14B
- steps: 4-8步
- cfg: 1.0-1.5
- 连接: 使用 `high_positive` 和 `high_negative`

**低噪采样器（负责细节）**:
- 模型: wan2.2_i2v_low_noise_14B
- steps: 4-8步
- cfg: 1.0-1.5
- 连接: 使用 `low_positive` 和 `low_negative`

**两组采样器设置**:
- start_at_step: 0 → end_at_step: 2（第一阶段）
- start_at_step: 2 → end_at_step: 100（第二阶段）
- add_noise: enable → disable

### 示例场景配置

**场景**: 人物在操场跑步

**推荐参数**:
- motion_amplitude: 2.5（跑步需要较大动态）
- color_protect: True
- correct_strength: 0.1（动态大时可能偏色，增加校正强度）
- 提示词: "镜头不断后退跟拍，男人奋力划船，小船在河中快速前进，男人表情疲惫但坚韧"
- 负向词: "色调艳丽，过曝，静态，细节模糊不清，字幕，风格，作品，画作，画面，静止，整体发灰，最差质量，低质量，JPEG压缩残留，丑陋的，残缺的，多余的手指，画得不好的手部，画得不好的脸部，畸形的，毁容的，形态畸形的肢体，手指融合，静止不动的画面，杂乱的背景，三条腿，背景人很多，倒着走，偏绿，偏暗"

## 常见问题

### Q: 开启动态保护后，视频还是偏绿怎么办？

A: 逐步增加 `correct_strength`：
1. 从0.05增加到0.1
2. 如果还有轻微偏绿，增加到0.15
3. 如果偏绿严重，增加到0.2-0.3

### Q: 动态幅度不够怎么办？

A: 增加 `motion_amplitude`：
1. 从1.3增加到1.8-2.0
2. 如果还不够，增加到2.5-3.0
3. 注意超过3.0时可能需要同步增加 `correct_strength`

### Q: 动态强度够了，但画面闪烁怎么办？

A: 这是高动态下的正常现象，可以尝试：
1. 降低 `motion_amplitude` 0.2-0.3
2. 或者增加 `correct_strength` 0.05
3. 检查提示词是否包含"静态"、"不动"等负面词

### Q: 如何确认动态是否完全保留？

A: 对比测试：
1. 设置 `color_protect = False`
2. 生成一段视频
3. 再设置 `color_protect = True` 和 `correct_strength = 0.05`
4. 生成第二段视频
5. 对比两段视频的动态幅度，应该完全一致

## 技术原理

本节点采用**后处理校正策略**：

1. **动态增强**: 完全保留原始算法 `diff_centered * motion_amplitude`，不做任何限制
2. **漂移检测**: 计算增强前后各通道的均值漂移，识别异常通道
3. **温和校正**: 仅对漂移超过12%的通道做0.8%的温和拉回，只影响正值区域
4. **亮度保护**: 对暗部（latent < 0.5）做不超过4%的温和提亮

这种设计确保：
- **动态零损失**: 增强逻辑完全不变
- **颜色稳定性**: 有效抑制偏绿、偏暗
- **细节保留**: 负值区域（动态细节）完全不受影响
- **可控性**: 通过 `correct_strength` 精准调节

## 更新日志

- 2025-12-30: 初始版本发布
  - 支持双输出设计
  - 实现后处理颜色校正
  - 优化节点宽度

## 致谢

感谢 Wan2.2 社区提供的优秀基础模型，以及 ComfyUI 团队的强大框架支持。
